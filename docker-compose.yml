services:
  jira_metrics_extractor:
    image: ${ECR_REPOSITORY_NAME}/jira-metrics-extractor:latest
    build:
      context: .
      dockerfile: ./docker/apps/jira_metrics_extractor/Dockerfile
    volumes:
      - ./docker/data:/data
    environment:
      - JIRA_USERNAME=${JIRA_USERNAME}
      - JIRA_PASSWORD=${JIRA_PASSWORD}
      - OUTPUT_PATH=/data/jira_metrics.csv
      - CUSTOM_JQL=${CUSTOM_JQL}
  reporting_app:
    image: ${ECR_REPOSITORY_NAME}/reporting-app:latest
    build:
      context: .
      dockerfile: ./docker/apps/reporting_app/Dockerfile
    ports:
      - "8050:8050"
    volumes:
      - ./docker/data:/data
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8050/ || exit 1"]
      interval: 30s
      timeout: 5s
      retries: 3
      start_period: 10s
    environment:
      - REPORTING_CSV_PATH=/data/jira_metrics.csv
      - HOST=0.0.0.0